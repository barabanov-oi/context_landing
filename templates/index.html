{% extends 'base.html' %}
{% block title %}Кейсы по юридической лидогенерации{% endblock %}

{% block head_extra %}
<style>
  .hero-block { background: linear-gradient(135deg, #1d4ed8 0%, #0b5ed7 50%, #0f766e 100%); border-radius: 20px; padding: 2rem; border: 1px solid rgba(255,255,255,.2); }
  .hero-kpi-frame {
    width: 75%;
    margin: 0 auto 1.5rem;
    padding: 1rem;
    border: 1px solid rgba(255,255,255,.22);
    border-radius: 16px;
  }

  .hero-kpi {
    width: 100%;
    min-height: 9.5rem;
    padding: .5rem;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    text-align: center;
  }
  .hero-kpi .value { font-size: 4em; font-weight: 800; display: block; line-height: 1; }
  .hero-kpi .label { font-size: 1.28rem; color: rgba(240,247,255,.9); margin-top: .35rem; line-height: 1.15; max-width: 15ch; }

  .hero-title { text-align: center; margin-top: 2em; margin-bottom: 2em; }

  .warmup-list li { margin-bottom: .45rem; color: rgba(232,240,255,.92); }

  .filter-wrap { background: #102341; border: 1px solid rgba(255,255,255,.16); border-radius: 14px; padding: 1rem; }

  .case-link { text-decoration: none; color: inherit; display: block; height: 100%; }
  .case-card { background: #1a2f52; border: 1px solid rgba(190,216,255,.25); border-radius: 16px; padding: 1rem; height: 100%; transition: transform .22s ease, box-shadow .22s ease, border-color .22s ease; }
  .case-link:hover .case-card { transform: translateY(-4px); border-color: rgba(72, 163, 255, .85); box-shadow: 0 16px 34px rgba(0,0,0,.34); }

  .niche-icon { font-size: 1.4rem; margin-right: .55rem; }
  .result-line { font-size: .92rem; color: #edf4ff; }
  .source-chip { display: inline-block; padding: .18rem .55rem; border-radius: 999px; font-size: .75rem; margin-right: .35rem; margin-bottom: .35rem; font-weight: 700; }
  .source-search { background: rgba(32, 197, 116, .2); color: #8effc0; border: 1px solid rgba(32,197,116,.45); }
  .source-rsya { background: rgba(13, 110, 253, .2); color: #8ec0ff; border: 1px solid rgba(13,110,253,.45); }
  .source-retarget { background: rgba(138, 43, 226, .22); color: #ddb2ff; border: 1px solid rgba(138,43,226,.45); }
  .source-content { background: rgba(255, 193, 7, .2); color: #ffe18e; border: 1px solid rgba(255,193,7,.45); }

  .animate-kpi { animation: pulseMetric .9s ease both; }
  .hero-kpi.is-visible .value { animation: pulseMetric .8s ease both; }
  @keyframes pulseMetric { from { transform: scale(.95); opacity: .6; } to { transform: scale(1); opacity: 1; } }

  .timeline { border-left: 2px solid rgba(125,181,255,.55); margin: 0; padding-left: 1rem; list-style: none; }
  .timeline li { position: relative; padding: .2rem 0 .8rem; }
  .timeline li::before { content: ''; width: 10px; height: 10px; border-radius: 50%; background: #76b6ff; position: absolute; left: -1.35rem; top: .45rem; }

  @media (max-width: 767px) {
    .hero-block { padding: 1.4rem; }
    .hero-kpi-frame { width: 100%; padding: .7rem; }
    .hero-kpi { min-height: auto; }
    .hero-kpi .value { font-size: 4em; }
    .hero-kpi .label { font-size: .95rem; }
    .hero-title { margin-top: 2em; margin-bottom: 2em; }
  }
</style>
{% endblock %}

{% block content %}
<section class="hero-block mb-4">
  <h1 class="display-6 fw-bold hero-title">Помощь в росте конверсий, лидов, продаж, выручки</h1>
  <div class="hero-kpi-frame">
    <div class="row g-2">
    <div class="col-md-4">
      <div class="hero-kpi animate-kpi" data-count-target="8" data-count-suffix="">
        <span class="value">0</span>
        <span class="label">лет опыта в digital</span>
      </div>
    </div>
    <div class="col-md-4">
      <div class="hero-kpi animate-kpi" data-count-target="18" data-count-suffix="">
        <span class="value">0</span>
        <span class="label">различных ниш</span>
      </div>
    </div>
    <div class="col-md-4">
      <div class="hero-kpi animate-kpi" data-count-target="40000000" data-count-suffix="" data-count-prefix="" data-count-postfix="" data-count-split="true">
        <span class="value">0</span>
        <span class="label">руб./мес. максимальный бюджет одного размещения</span>
      </div>
    </div>
    </div>
  </div>
  <p class="mb-2 fs-5">Работаю с реально важными для бизнеса показателями: CPA, CPL, CPO, ДРР, ROI, ROMI</p>
  <p class="mb-3 fs-6 text-light">Работаю со сквозной аналитикой: calltouch, Roistat, АМОCrm, Битрикс24</p>
  <div class="d-flex gap-2 flex-wrap">
    <a href="#cases" class="btn btn-light">Посмотреть кейсы</a>
    <a href="#contacts" class="btn btn-outline-light">Получить аудит рекламы</a>
  </div>
</section>

<section class="card-glass p-4 mb-4" id="about-me">
  <h2 class="h4 fw-bold mb-3">{{ site_content.about_me_title }}</h2>
  <p class="text-muted-1 mb-0" style="white-space: pre-line;">{{ site_content.about_me_text }}</p>
</section>

<section class="row g-3 mb-4" id="about">
  <div class="col-lg-6">
    <article class="card-glass p-3 h-100">
      <h2 class="h5 fw-bold">Почему лиды у юристов дорогие</h2>
      <ul class="warmup-list mb-0 ps-3">
        <li>Высокая конкуренция в поиске и перегретые ставки.</li>
        <li>Смешение разных услуг в одной кампании без сегментации.</li>
        <li>Потеря тёплого спроса без ретаргетинга и контент-догрева.</li>
      </ul>
    </article>
  </div>
  <div class="col-lg-6">
    <article class="card-glass p-3 h-100">
      <h2 class="h5 fw-bold">Как это решается</h2>
      <ul class="warmup-list mb-0 ps-3">
        <li>Кластеризация запросов по юридическим сценариям.</li>
        <li>Сегментация аудитории и офферов по этапам принятия решения.</li>
        <li>Связка Поиск + РСЯ + ретаргетинг для снижения CPL и роста CR.</li>
      </ul>
    </article>
  </div>
</section>

<section class="card-glass p-3 mb-4" id="pricing">
  <div class="row g-3 text-center">
    <div class="col-md-4"><div class="h3 fw-bold mb-1">5500+</div><div class="text-muted-1">клиентов в legal и смежных нишах</div></div>
    <div class="col-md-4"><div class="h3 fw-bold mb-1">8 лет</div><div class="text-muted-1">практики в контекстной рекламе</div></div>
    <div class="col-md-4"><div class="h3 fw-bold mb-1">120 млн ₽</div><div class="text-muted-1">суммарного рекламного бюджета</div></div>
  </div>
</section>

<section class="filter-wrap mb-3" id="cases">
  <form class="row g-2 align-items-end" method="get">
    <div class="col-md-5">
      <label class="form-label" for="niche">Фильтр по нише</label>
      <select class="form-select" id="niche" name="niche">
        <option value="">Все ниши</option>
        {% for niche in niches %}
          <option value="{{ niche }}" {% if niche == selected_niche %}selected{% endif %}>{{ niche }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-5">
      <label class="form-label" for="source">Фильтр по источнику</label>
      <select class="form-select" id="source" name="source">
        <option value="">Все источники</option>
        {% for source in sources %}
          <option value="{{ source }}" {% if source == selected_source %}selected{% endif %}>{{ source }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-2 d-grid">
      <button class="btn btn-primary" type="submit">Применить</button>
    </div>
  </form>
</section>

<div class="row g-3">
  {% for case in cases %}
    <div class="col-lg-4 col-md-6">
      <a class="case-link" href="{{ url_for('case_detail', slug=case.slug) }}">
        <article class="case-card">
          <div class="d-flex align-items-center mb-2"><span class="niche-icon">{{ case.icon or '⚖️' }}</span><h2 class="h5 fw-bold mb-0">{{ case.title }}</h2></div>
          <div class="result-line"><strong>{{ case.leads or '—' }} лидов</strong></div>
          <div class="result-line">CPL: <strong>{{ case.cpl or '—' }}</strong> · CR: <strong>{{ case.cr or '—' }}</strong></div>
          <div class="result-line mb-2">Бюджет: <strong>{{ case.budget or '—' }}</strong></div>
          <div class="small text-muted-1 mb-2">{{ case.subtitle }}</div>
          <div class="mb-2">
            {% for source in case.sources %}
              {% set cls = 'source-chip' %}
              {% if source == 'Поиск' %}{% set cls = cls + ' source-search' %}{% endif %}
              {% if source == 'РСЯ' %}{% set cls = cls + ' source-rsya' %}{% endif %}
              {% if source == 'Ретаргет' %}{% set cls = cls + ' source-retarget' %}{% endif %}
              {% if source == 'Контент' %}{% set cls = cls + ' source-content' %}{% endif %}
              <span class="{{ cls }}">{{ source }}</span>
            {% endfor %}
          </div>
          <button class="btn btn-outline-light btn-sm">Открыть кейс</button>
        </article>
      </a>
    </div>
  {% else %}
    <div class="col-12"><div class="alert alert-info">По выбранным фильтрам пока нет кейсов.</div></div>
  {% endfor %}
</div>

<section class="row g-3 mt-4">
  <div class="col-lg-6">
    <article class="card-glass p-3 h-100">
      <h2 class="h5 fw-bold">Таймлайн проекта</h2>
      <ul class="timeline">
        <li><strong>1 неделя</strong> — аудит аккаунта и семантики.</li>
        <li><strong>3 неделя</strong> — сегментация запросов и объявлений.</li>
        <li><strong>5 неделя</strong> — оптимизация ставок и ретаргетинг.</li>
        <li><strong>8 неделя</strong> — фиксация результата и масштабирование.</li>
      </ul>
    </article>
  </div>
  <div class="col-lg-6" id="contacts">
    <article class="card-glass p-4 h-100 d-flex flex-column justify-content-center">
      <h2 class="h4 fw-bold">Хотите такие же результаты?</h2>
      <p class="text-muted-1">Получите аудит рекламной кампании и план роста лидов на 90 дней.</p>
      <div><a href="{{ url_for('signup') }}" class="btn btn-success">Получить аудит</a></div>
    </article>
  </div>
</section>
{% endblock %}

{% block scripts %}
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const formatNumber = (value) => new Intl.NumberFormat('ru-RU').format(value);
    const cards = document.querySelectorAll('.hero-kpi[data-count-target]');

    const animateNumber = (card) => {
      if (card.dataset.animated === 'true') return;
      const target = Number(card.dataset.countTarget || 0);
      const suffix = card.dataset.countSuffix || '';
      const postfix = card.dataset.countPostfix || '';
      const valueEl = card.querySelector('.value');
      const duration = 1200;
      const startedAt = performance.now();

      const renderValue = (rawValue, isFinal = false) => {
        const formatted = `${formatNumber(rawValue)}${suffix}${isFinal ? postfix : ''}`;
        if (card.dataset.countSplit === 'true' && isFinal) {
          valueEl.innerHTML = formatted.replace('40 000 000', '40<br>000 000');
          return;
        }
        valueEl.textContent = formatted;
      };

      const tick = (now) => {
        const progress = Math.min((now - startedAt) / duration, 1);
        const current = Math.floor(target * progress);
        renderValue(current);
        if (progress < 1) {
          requestAnimationFrame(tick);
          return;
        }
        renderValue(target, true);
        card.classList.add('is-visible');
      };

      card.dataset.animated = 'true';
      requestAnimationFrame(tick);
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          animateNumber(entry.target);
          observer.unobserve(entry.target);
        }
      });
    }, { threshold: 0.4 });

    cards.forEach((card) => observer.observe(card));
  });
</script>
{% endblock %}
