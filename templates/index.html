{% extends 'base.html' %}
{% block title %}–õ–µ–Ω—Ç–∞ –∫–µ–π—Å–æ–≤{% endblock %}

{% block head_extra %}
<style>
  .case-cover-wrap {
    position: relative;
    border-radius: 12px;
    overflow: hidden;
    border: 1px solid rgba(255,255,255,.18);
    margin-bottom: 1rem;
  }
  .case-cover {
    width: 100%;
    height: 220px;
    object-fit: cover;
    display: block;
  }
  .case-cover-darken {
    position: absolute;
    inset: 0;
    background: linear-gradient(180deg, rgba(5,12,25,.12) 0%, rgba(5,12,25,.7) 68%, rgba(5,12,25,.88) 100%);
  }
  .cover-metrics {
    position: absolute;
    left: .75rem;
    right: .75rem;
    bottom: .75rem;
    display: grid;
    grid-template-columns: repeat(3, minmax(0, 1fr));
    gap: .45rem;
  }
  .cover-metric-item {
    border: 1px solid rgba(255,255,255,.24);
    background: rgba(9,20,39,.7);
    backdrop-filter: blur(3px);
    border-radius: 10px;
    padding: .4rem .45rem;
    min-height: 56px;
  }
  .cover-metric-title {
    font-size: .68rem;
    color: rgba(255,255,255,.74);
    display: flex;
    align-items: center;
    gap: .28rem;
    line-height: 1.1;
  }
  .cover-metric-value {
    margin-top: .22rem;
    font-weight: 700;
    font-size: .82rem;
    color: #fff;
    line-height: 1.1;
  }
  .trend-up { color: #58f5b0; }
  .trend-bars { color: #7cb9ff; }
  .trend-donut { color: #fdd46b; }

  .metrics-grid { display: grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap: .65rem; }
  .metric-vivid {
    border-radius: 14px;
    padding: .7rem;
    border: 1px solid rgba(255,255,255,.2);
    background: linear-gradient(155deg, rgba(0,212,255,.18), rgba(126,91,255,.2));
  }
  .metric-vivid.alt-2 { background: linear-gradient(155deg, rgba(255,214,107,.2), rgba(255,110,199,.2)); }
  .metric-vivid.alt-3 { background: linear-gradient(155deg, rgba(61,255,224,.2), rgba(124,185,255,.2)); }
  .metric-icon { font-size: 1.15rem; }
  .metric-bar { height: 6px; border-radius: 999px; background: rgba(255,255,255,.18); overflow: hidden; }
  .metric-bar > span { display: block; height: 100%; width: 72%; background: linear-gradient(90deg, #00d4ff, #7e5bff); }
  @media (max-width: 767px) {
    .metrics-grid, .cover-metrics { grid-template-columns: 1fr; }
    .case-cover { height: 260px; }
  }
</style>
{% endblock %}

{% block content %}
<section class="mb-4">
  <h1 class="display-6 fw-bold">–ö–µ–π—Å—ã –ø–æ —é—Ä–∏–¥–∏—á–µ—Å–∫–æ–π –ª–∏–¥–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏</h1>
  <p class="text-muted-1">–ö–∞—Ä—Ç–æ—á–∫–∏ –≤ –ª–µ–Ω—Ç–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –æ–±–ª–æ–∂–∫—É –∏ –Ω–∞–≥–ª—è–¥–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –∫–µ–π—Å–∞.</p>
</section>

<div class="row g-4">
  {% for case in cases %}
    {% set metrics = [
      {'label': case.metric_1_label, 'value': case.metric_1, 'icon': 'üç©', 'trend': '‚óî', 'trend_class': 'trend-donut'},
      {'label': case.metric_2_label, 'value': case.metric_2, 'icon': 'üìä', 'trend': '‚ñÆ‚ñÆ‚ñÆ', 'trend_class': 'trend-bars'},
      {'label': case.metric_3_label, 'value': case.metric_3, 'icon': 'üìà', 'trend': '‚Üó', 'trend_class': 'trend-up'}
    ] %}
    <div class="col-lg-6">
      <article class="card-glass p-4 h-100">
        <div class="case-cover-wrap">
          <img
            class="case-cover"
            src="{{ url_for('static', filename=case.cover_image if case.cover_image else 'images/case-placeholder.svg') }}"
            alt="–û–±–ª–æ–∂–∫–∞ –∫–µ–π—Å–∞ {{ case.title }}"
          >
          <div class="case-cover-darken"></div>
          <div class="cover-metrics">
            {% for metric in metrics if metric.value %}
              <div class="cover-metric-item">
                <div class="cover-metric-title">
                  <span>{{ metric.icon }}</span>
                  <span>{{ metric.label if metric.label else '–ü–æ–∫–∞–∑–∞—Ç–µ–ª—å ' ~ loop.index }}</span>
                </div>
                <div class="cover-metric-value">
                  <span class="{{ metric.trend_class }}">{{ metric.trend }}</span>
                  {{ metric.value }}
                </div>
              </div>
            {% endfor %}
          </div>
        </div>

        <h2 class="h4 fw-bold mb-1">{{ case.title }}</h2>
        <p class="text-muted-1 mb-2">{{ case.subtitle }} {% if case.duration %}‚Ä¢ {{ case.duration }}{% endif %}</p>
        <div class="mb-2">
          {% for tag in case.tags %}<span class="pill">{{ tag }}</span>{% endfor %}
        </div>
        <p class="text-muted-1">{{ case.teaser }}</p>

        <div class="metrics-grid mb-3">
          {% for metric in metrics if metric.value %}
            <div class="metric-vivid alt-{{ loop.index }}">
              <div class="d-flex justify-content-between align-items-center mb-2">
                <span class="metric-icon">{{ metric.icon }}</span>
                <small class="text-white-50">{{ metric.label if metric.label else '–ü–æ–∫–∞–∑–∞—Ç–µ–ª—å ' ~ loop.index }}</small>
              </div>
              <div class="fw-semibold small mb-2">{{ metric.value }}</div>
              <div class="metric-bar"><span style="width: {{ 58 + loop.index * 12 }}%"></span></div>
            </div>
          {% endfor %}
        </div>

        <a class="btn btn-outline-light" href="{{ url_for('case_detail', slug=case.slug) }}">–ß–∏—Ç–∞—Ç—å –∫–µ–π—Å</a>
      </article>
    </div>
  {% endfor %}
</div>
{% endblock %}
